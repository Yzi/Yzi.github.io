<script async src="https://www.googletagmanager.com/gtag/js?id=UA-183049007-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-183049007-1');
</script>

{{ with .Params.comments }}
<div id="disqus_thread"></div>
<script>
function d(t){
  return document.createElement(t);
}
function u(t, a, n) {
    var s = d("script");
    s.src = t,
    a && (s.onload = a),
    n && (s.type = "module"),
    s.async = !0,
    s.crossOrigin = "anonymous",
    document.body.appendChild(s)
}
function loadDisqus() {
  // Disqus 安装代码
  var t = d("link");
  t.rel = "stylesheet",
  t.href = "https://cdn.jsdelivr.net/npm/sks@0.2.8/disqusjs.css",
  t.crossOrigin = "anonymous",
  t.media = "print",
  t.onload = function () {
    t.media = "all",
    t.onload = null
  },
  document.head.appendChild(t);
  u("https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js", function () {
    // 如果你和我一样在用 DisqusJS，loadDisqus() 里就应该是 DisqusJS 的初始化代码 new DisqusJS({...})
    new DisqusJS({
      shortname: "yzi",
      api: "https://disqus.yzi.io/",
      apikey: "AmJsSVQd4S5jFk8Uo40Cl87RtltZmpSM0JlIGz3O194CkjqXvzkHkEDWMHxPeTLp",
      admin: "Yzi"
    })
  })
}

// 通过检查 window 对象确认是否在浏览器中运行
var runningOnBrowser = typeof window !== "undefined";
// 通过检查 scroll 事件 API 和 User-Agent 来匹配爬虫
var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
// 检查当前浏览器是否支持 IntersectionObserver API
var supportsIntersectionObserver = runningOnBrowser && "IntersectionObserver" in window;

// 一个小 hack，将耗时任务包裹在 setTimeout(() => { }, 1) 中，可以推迟到 Event Loop 的任务队列中、等待主调用栈清空后才执行，在绝大部分浏览器中都有效
// 其实这个 hack 本来是用于优化骨架屏显示的。一些浏览器总是等 JavaScript 执行完了才开始页面渲染，导致骨架屏起不到降低 FCP 的优化效果，所以通过 hack 将耗时函数放到骨架屏渲染完成后再进行。
setTimeout(function () {
  if (!isBot && supportsIntersectionObserver) {
    // 当前环境不是爬虫、并且浏览器兼容 IntersectionObserver API
    var disqus_observer = new IntersectionObserver(function(entries) {
      // 当前视窗中已出现 Disqus 评论框所在位置
      if (entries[0].isIntersecting) {
        // 加载 Disqus
        loadDisqus();
        // 停止当前的 Observer
        disqus_observer.disconnect();
      }
    }, { threshold: [0] });
    // 设置让 Observer 观察 #disqus_thread 元素
    disqus_observer.observe(document.getElementById('disqus_thread'));
  } else {
    // 当前环境是爬虫、或当前浏览器其不兼容 IntersectionObserver API
    // 直接加载 Disqus
    loadDisqus();
  }
}, 1);
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
{{ end }}

{{ if ne .Site.Params.hideMadeWithLine true }}Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a>{{ end }}
